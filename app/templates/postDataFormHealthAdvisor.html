{% extends 'base.html' %}
{% block content %}
    <h1>{% block title %} Add an entry for Health Advisor Prediction {% endblock %}</h1>
    <button id="getDataButton">Get Max30102 Data</button>
    <form method="post">
        <label for="name">Name</label>
        <br>
        <textarea id = "NameTextArea"
                  name="name"
                  placeholder="Juan Perez"
                  rows="1"
                  cols="30"
                  >{{ request.form['name'] }}</textarea>
        <br>
        <label for="rut">Rut</label>
        <br>
        <textarea id = "RutTextArea"
                  name="rut"
                  placeholder="12345678-9"
                  rows="1"
                  cols="30"
                  >{{ request.form['rut'] }}</textarea>
        <br>
        <label for="hr">Heart Rate</label>
        <br>
        <textarea id = "HRTextArea"
                  name="hr"
                  placeholder="60"
                  rows="1"
                  cols="30"
                  >{{ request.form['hr'] }}</textarea>
        <br>
        <label for="spo2">Oxygen Saturation</label>
        <br>
        <textarea id = "SpO2TextArea"
                  name="spo2"
                  placeholder="98"
                  rows="1"
                  cols="30"
                  >{{ request.form['spo2'] }}</textarea>
        <br>
        <label for="age">Age</label>
        <br>
        <textarea id = "AgeTextArea"
                  name="age"
                  placeholder="25"
                  rows="1"
                  cols="30"
                  >{{ request.form['age'] }}</textarea>
        <br>
        <label for="gender">Gender</label>
        <br>
        <select id = "GenderTextArea" name="gender">
          <option value=0>Female</option>
          <option value=1>Male</option>
        </select>
        <br>
        <label for="t">Temperature</label>
        <br>
        <textarea id = "TemperatureTextArea" name="t" placeholder="36"
          rows="1"
          cols="30"
          >{{ request.form['t'] }}</textarea>
        <br>
        <label for="glucose">Glucose</label>
        <br>
        <textarea id = "GlucoseTextArea" name="glucose" placeholder="87"
          rows="1"
          cols="30"
          >{{ request.form['glucose'] }}</textarea>
        <br>
        <label for="sbp">Systolic Blood Pressure</label>
        <br>
        <textarea id = "SBPTextArea" name="sbp" placeholder="144"
          rows="1"
          cols="30"
          >{{ request.form['sbp'] }}</textarea>
        <br>
        <label for="dbp">Diastolic Blood Pressure</label>
        <br>
        <textarea id = "DBPTextArea" name="dbp" placeholder="92"
          rows="1"
          cols="30"
          >{{ request.form['dbp'] }}</textarea>
        <br>
        <br>
        <button type="submit">Submit</button>
      </form>
    <script type="text/javascript" charset="utf-8">
        const socket = io({autoConnect: false})
        document.getElementById("getDataButton").addEventListener("click", function() {
    
          socket.connect();
    
          socket.on("connect", function() {
            socket.emit("get_esp32_data");
            console.log("User waiting for data to display")
          })
          // listen for mqtt_message events
          // when a new message is received, log and append the data to the page
          socket.on('mqtt_message', function(data) {
            console.log(data);
            if (data["topic"] == "/Max30102FromESP32") {
              var text = data['payload'];
              var text = text.split(";")
              console.log(data["payload"])
              var hr_text = text[0].split("=")[1]
              var spo2_text = text[1].split("=")[1]
              console.log(hr_text, spo2_text)
              document.getElementById("HRTextArea").value = hr_text;
              document.getElementById("SpO2TextArea").value = spo2_text;
            }
          })
        })
      </script>
{% endblock %}